%\chapter{Arquitetura proposta para um sistema de manutenção inteligente}
\chapter{Arquitetura proposta}

\todo[inline]{Introdução do capítulo. Revisar o capítulo para se adequar às novas alterações.}


%%
\section{Arquitetura orientada a serviços proposta}

A arquitetura proposta neste trabalho tem por objetivo a integração de sistemas de manutenção
inteligente, dos diversos equipamentos que precisam ser monitorados, além de outras entidades que
auxiliam no funcionamento do sistema. A troca de informações entre todos os elementos que compõem a
arquitetura é abstraída na forma de serviços, o que facilita a integração, inserção e remoção de
novas entidades no sistema. Dessa forma, a especificação da arquitetura é definida utilizando os
padrões \gls{SOA}. Uma visão geral das entidades que fazem parte da arquitetura proposta é
apresentada na \cref{fig:soa-proposed-architecture}\todo{Alterar figura. A aplicação SOA deve
englobar mais entidades}. Na figura, nota-se que cada entidade tem uma função específica no sistema
e o acesso às suas funcionalidades é realizado através de serviços. A seguir, para melhor
entendimento, todos os elementos serão detalhados.

\includefigure
  {images/soa-proposed-architecture}
  {Arquitetura orientada a serviços proposta para integração de um sistema de manutenção
      inteligente.}
  {fig:soa-proposed-architecture}


%%%
\subsection{Serviço}

No contexto da arquitetura proposta neste trabalho, serviço é um componente de software que
encapsula uma funcionalidade acessível através dos padrões definidos pela tecnologia \gls{SOA}.
Todos os componentes da arquitetura expõem as suas funcionalidades na forma de serviços,
possibilitando que a interação entre eles seja feita de forma transparente. Como parte do padrão
\gls{SOA}, serviços podem ser descobertos e utilizados por clientes que desejam executar uma
determinada tarefa. Neste contexto, também é possível a definição de serviços mais especializados
com base em outros serviços, praticando a técnica da composição de serviços. Estas características
se tornam inerentes à proposta, devido a utilização do padrão \gls{SOA}.


%%%
\subsection{Dispositivo}

Um dispositivo é um componente de software utilizado para encapsular um elemento físico da aplicação
proposta. Por ser executado em um dispositivo físico, o componente é denominado dispositivo lógico e
disponibiliza serviços para acesso à funcionalidades previamente definidas. As funcionalidades podem
ser relativas ao dispositivo físico em que o componente está executando ou outras que auxiliam em
alguma tarefa específica não relacionada diretamente com o hardware hospedeiro.

Do ponto de vista da aplicação, os dispositivos são entidades que hospedam serviços. Dentre os
serviços hospedados, alguns estão presentes em todos os dispositivos da arquitetura, servindo de
base para a comunicação entre todos os elementos desta classe. Dessa forma, conhecendo os serviços
básicos, uma interface mínima para troca de informações entre as entidades do sistema é definida,
facilitando a inserção de novos dispositivos.

Além dos serviços base, outros podem ser executados no dispositivo. A arquitetura permite o envio de
novos serviços para os dispositivos do sistema. O dispositivo recebe o novo serviço, que possui as
mesmas funcionalidades de um serviço padrão, e o carrega para ser executado normalmente.


%%%
\subsection{Aplicação orientada a serviços}

A \todo{Alterar texto para englobar mais entidades da arquitetura}aplicação orientada a serviços
nada mais é do que o resultado da utilização dos diversos serviços propostos na arquitetura. Através
da composição ou utilização direta dos serviços de uma forma coordenada, a aplicação é construída.
De um modo minimalista, a aplicação pode ser vista como a interação progressiva de funcionalidades
simples provenientes de serviços básicos, resultando em um componente complexo de software. Visto
que o produto final da composição dos elementos do sistema não é definido \textit{a priori}, o
resultado da aplicação pode ser qualquer construção ou interação entre os componentes.


%%%
\subsection{Gerenciador de dispositivos}

Como o nome sugere, o Gerenciador de Dispositivos é um componente de software utilizado para
gerenciar os dispositivos da arquitetura proposta. A configuração ou obtenção da lista dos
dispositivos na aplicação orientada a serviços são exemplos de funcionalidades do gerenciador. Como
os dispositivos são entidades que mapeiam funcionalidades dos dispositivos físicos encontrados em um
sistema de manutenção inteligente, o gerenciador pode, por exemplo, obter a lista de sensores do
equipamento e configurar alguns parâmetros, como a taxa de atualização dos dados dos sensores.
Também é possível definir comportamentos adicionais para o caso do equipamento estar operando em
diferentes níveis de degradação. Os diferentes comportamentos podem ser utilizados quando há
necessidade de operar o equipamento em condições onde manter os níveis de degradação estáveis é mais
importante do que a operação a pleno. Portanto, pode-se manter o equipamento funcionando até que uma
manutenção \textit{in loco} possa ser realizada.

Grupos de dispositivos podem ser criados e gerenciados. O Gerenciador de Dispositivos permite a
criação de grupos, a fim de facilitar a alteração simultânea de vários dispositivos. Supondo que a
aplicação é inerentemente escalável, o número de dispositivos tente a aumentar, o que dificulta o
gerenciamento ou configuração de dispositivos similares. Considerando que as configurações aplicadas
a uma mesma classe de dispositivos é muito parecida, o gerenciador permite que um grupo receba os
mesmos parâmetros, automatizando o processo de customização dos dispositivos.

Outra funcionalidade que o gerenciador provê é a obtenção da topologia dos componentes do sistema.
Em uma arquitetura \gls{SOA} todos os serviços estão localizados no mesmo nível hierárquico. Essa
característica pode ser considerada positiva do ponto de vista de integração e reuso de serviços. Em
contrapartida, ao definir níveis hierárquicos entre componentes de um mesmo dispositivo físico, a
complexidade para o estabelecimento de uma hierarquia lógica para representação das diferentes
partes desse dispositivo aumenta. Contudo, ao aplicar um identificador único para cada dispositivo,
ou parte de dispositivo, do sistema, torna-se possível definir e estabelecer uma relação
hierárquica. O identificador pode ser uma \gls{URI}, por exemplo, onde cada parte do endereço se
refere a um dos níveis hierárquicos.

O Gerenciador de Dispositivos também é utilizado na resolução de problemas encontrados durante a
execução dos componentes do sistema. A entidade se enquadra na categoria de \gls{IHM},
possibilitando que a rede seja mapeada em busca de dispositivos ou serviços de forma interativa.
Além disso, é possível obter o estado dos dispositivo, visualizar dados ou testar os serviços
encontrados.

\todo[inline]{Falar sobre os valores de confiança. É interessante que o gerenciador de dispositivos
forneça os históricos da saúde do equipamento.}


%%%
\subsection{Gerenciador de análises}

O Gerenciador de Análises é utilizado para definir o plano que será aplicado a determinado
equipamento, ou grupo de equipamentos, \todo{Em ou com?}com vista a obter os níveis de degradação.
Nesta entidade, é possível selecionar e definir a ordem em que serão executadas as ferramentas de
análise de dados através de um plano. O gerenciador permite o agendamento dos planos e a execução
periódica em intervalos de tempo. Os planos também podem ser gerenciados, possibilitando alteração
e/ou exclusão.

No plano são definidos os comportamentos a serem adotados com base nos valores de degradação do
equipamento. O gerenciador obtém os comportamentos previamente definidos para o equipamento a ser
analisado, os quais podem ser mapeados pelo usuário para diferentes níveis de degradação. Dessa
forma, o equipamento pode ser adaptado a diferentes condições, por exemplo, evitando o aumento da
degradação até que uma manutenção possa ser realizada.

Esta entidade também coordena as análises realizadas em um grupo de equipamentos similares. O
processo de obtenção dos valores de confiança de um conjunto de equipamentos pode ser simplificado
pelo fato de que, se são similares, o nível de degradação de um equipamento pode ser aproximado para
o nível de degradação do grupo. Dessa maneira, é possível elaborar um plano de análise que seja
aplicável a vários equipamentos.

\todo[inline]{Utilização da base de dados para armazenamento dos planos.}


%%%
\subsection{Analisador de dispositivos}

O Analisador de Dispositivos concentra todas as ferramentas necessárias para a realização da análise
dos dados de determinado dispositivo. A entidade opera com base nos planos criados e agendados pelo
\todo{Operador do sistema?}usuário no Gerenciador de Análises. De posse do plano, o analisador
executa as análises utilizando os algoritmos necessários para obtenção do resultado esperado. A
execução de um mesmo plano é feita de forma automática.

O analisador permite verificar quais planos estão sendo executados ou na fila para execução. Sempre
que um novo plano é encontrado, o analisador o coloca na fila de execução, a fim de que seja
finalizado o mais breve possível. A entidade permite o monitoramento destes planos pelo usuário, o
qual pode verificar se a execução está de acordo com o esperado.


%%%
\subsection{Base de dados}

A entidade Base de Dados é utilizada como uma interface para um banco de dados. O software encapsula
funcionalidades para  armazenar todos os dados relativos à aplicação. Desde os dados obtidos nas
análises de degradação dos equipamentos como também os planos de análise agendados pelo usuário. A
base centraliza as informações, mas não necessariamente faz com que a aplicação seja centralizada.
Nada impede a utilização de diferentes \todo{Remotas e locais? Alterar figura}bases de dados e o
compartilhamento de informações entre as entidade do sistema. Por exemplo, o armazenamento dos dados
de treinamento de um equipamento, necessário para obtenção do nível de degradação, pode ser feito em
diferentes bases de dados. O Analisador de Dispositivos pode combinar estas informações, a fim de
melhorar o resultado esperado.

Por ser defina como um componente \gls{SOA}, o acesso aos dados é feito através de serviços. A
inclusão, deleção e modificação de dados são realizadas por serviços especializados. Um dispositivo
remoto pode acessar a base de dados a fim de obter o histórico dos últimos valores de confiança
calculados ou valores de testes intermediários para determinado equipamento, utilizando-os para um
novo tipo de análise.


%%%
\subsection{Repositório de serviços}

O repositório de serviços é uma entidade que armazena os dispositivos lógicos e seus serviços, os
quais podem ser obtidos dinamicamente e implantados em dispositivos físicos. Esta entidade pode
estar localizada na rede local ou remota, com acesso disponível para várias aplicações. Dessa forma,
uma nova aplicação, isolada de outra já existente, pode ser construída com o reúso de componentes
obtidos de um repositório de serviços compartilhado pelas duas. Esta abordagem também permite o
compartilhamento de uma base de dados de componentes lógicos entre aplicações.


%%
\section{Casos de uso para a arquitetura proposta}

Os elementos que compõem a arquitetura proposta encaixam-se em alguns casos de uso no contexto de um
sistema de manutenção inteligente. Os casos de uso propostos a seguir exemplificam a interação do
operador do sistema, quando há a necessidade de busca ou configuração dos dispositivos, além da
ferramenta de análise de dados, que executa autonomamente sobre os dados obtidos durante o processo
de amostragem dos equipamentos.\todo{Introdução da seção com definição dos atores da aplicação.}


%%%
\subsection{Descoberta e configuração de dispositivos}

A descoberta dos dispositivos e serviços na rede pode ser feita a qualquer momento utilizando o
Gerenciador de Dispositivos. Cada um dos dispositivos encontrados é identificado e colocado em uma
lista de dispositivos ativos. Também são identificados os serviços hospedados em cada um dos
dispositivos. Dessa forma, é possível determinar quais dispositivos estão atualmente disponíveis na
rede e quais possuem serviços que poderão ser utilizados para suprir e executar determinada
funcionalidade do sistema.

A geração da hierarquia de recursos encontrados na rede também é possível. Ao aplicar um
identificador único para cada recurso, a reconstrução dos componentes do sistema pode ser obtida
agrupando-os em classes ou categorias. O identificador é utilizado para auxiliar a definir uma
topologia dos subdispositivos encontrados em um dispositivo lógico, facilitando a visualização e
configuração dos componentes.

O diagrama \gls{UML} de casos de uso para descoberta e configuração de dispositivos é apresentado na
\cref{fig:uml-discovery-setup-devices}. São ilustradas as interações que o operador do sistema pode
realizar nos dispositivos utilizando o Gerenciador de Dispositivos. Em vias gerais, o gerenciador
será utilizado pelo operador do sistema para descobrir os dispositivos da rede, obter o estado ou
realizar modificações nestes elementos.

\includefigure
  {images/uml-discovery-setup-devices}
  {Diagrama de casos de uso para descoberta e configuração de dispositivos.}
  {fig:uml-discovery-setup-devices}

Ao utilizar a descoberta de dispositivos, o gerenciador analisa todos dispositivos da aplicação
orientada a serviços. Os que forem encontrados são retornados, permitindo ao operador do sistema
verificar se a inclusão de um novo dispositivo foi concluída com êxito. Além disso, o gerenciador
permite obter o estado de cada elemento encontrado, o qual está relacionado ao funcionamento do
dispositivo, se está executando corretamente ou se está pronto para operação. Outras informações
também são obtidas utilizando os metadados. Esta funcionalidade lista dados como modelo, versão ou
fabricante do dispositivo.

Outra funcionalidade que o Gerenciador de Dispositivos disponibiliza é a obtenção da topologia da
distribuição dos dispositivos na rede. Dispositivos e serviços no padrão \gls{SOA} sempre estão
localizados no mesmo nível hierárquico, o que dificulta o estabelecimento de uma hierarquia entre os
componentes. No entanto, pode-se definir uma hierarquia utilizando para isso o identificador de cada
dispositivo. O identificador -- uma \gls{URI}, por exemplo -- é único para cada dispositivo da
aplicação, possibilitando que, na inclusão de subdispositivos, o identificador seja estendido para
englobá-los. Além disso, pode-se criar classes e subclasses de dispositivos, organizando
funcionalidades comuns para determinado dispositivo. A visualização das duas topologias possíveis é
apresentada na \cref{fig:device-topology-visualization}. À esquerda, os dispositivos estão
distribuídos como são encontrados pelo Gerenciador de Dispositivos. Na direita, o gerenciador
reconstrói a topologia baseado nos identificadores únicos de cada dispositivo. Nota-se que os
dispositivos, que na primeira topologia estão no mesmo nível hierárquico, agora são encontrados como
subdispositivos de outros dispositivos.

\includefiguretmp
  {Possíveis visualizações da topologia dos dispositivos.}
  {fig:device-topology-visualization}

Tomando de exemplo a \cref{fig:device-topology-visualization}, os identificadores de cada
dispositivo poderiam ser construídos com um dispositivo pai englobando outros dois subdispositivos.
Tanto o dispositivo pai como os subdispositivos estão definidos dentro de escopos ou áreas e essas
informações estão incluídas no identificador. A \cref{fig:device-topology-identification} demonstra
os identificadores utilizados para cada dispositivo, obedecendo os níveis hierárquicos\todo{Terminar
de falar sobre a figura, mencionando os componentes utilizados no exemplo (atuador elétrico)}.

\includefiguretmp
  {Identificação dos dispositivos na topologia hierárquica.}
  {fig:device-topology-identification}

Cada dispositivo pode armazenar diferentes comportamentos. Os comportamentos dizem respeito ao modo
de operação que o equipamento vai assumir perante determinada situação, sendo definidos pelo
operador do sistema. São diferentes tarefas que podem ser executadas pelo equipamento em situações
específicas. No caso de verificação de degradação excessiva de um equipamento, é possível alterar o
comportamento de funcionamento para outro que priorize a manutenção do estado de saúde atual,
evitando o aumento da degradação. Dessa forma, o equipamento pode operar por um período maior de
tempo até que uma manutenção possa ser realizada. Contudo, medidas que alteram o comportamento podem
levar a perda de desempenho nas tarefas executadas. A \cref{fig:device-send-behavior} ilustra o
envio de novos comportamentos pelo operador do sistema para um dispositivo. O dispositivo mantém uma
lista de comportamentos e seleciona qual o mais adequado para a situação corrente. A situação é
definida pelo nível de saúde obtido através das análises de dados e representa a degradação de todo
ou parte do equipamento.

\includefiguretmp
  {Envio de comportamentos para o dispositivo.}
  {fig:device-send-behavior}


%%%
\subsection{Envio de dados de treinamento}

Para obter o índice de degradação dos equipamento, as ferramentas de análise necessitam comparar os
dados obtidos durante o processo com dados de treinamento. Dentre os dados de treinamento, emergem
duas categorias: normal e falha. Os dados de funcionamento normal são obtidos quando o equipamento
está funcionando normalmente, enquanto que os dados de falha são obtidos quando o equipamento está
funcionando com algum tipo de degradação. A aquisição de ambos os tipos de dados são feitas em lugar
apropriado, tendo certeza das características de cada sinal.

O envio de dados de treinamento é feito através do Gerenciador de Dispositivos. O gerenciador
permite que o operador do sistema envie os dois tipo de dados, mapeando-os para um dispositivo ou
para um grupo de dispositivos. A \cref{fig:uml-training-data-send} apresenta os casos de uso para o
envio de dados de treinamento a um dispositivo.

\includefiguretmp
  {Diagrama de casos de uso para envio de dados de treinamento para um dispositivo.}
  {fig:uml-training-data-send}


%%%
\subsection{Gerenciamento de análises}

O gerenciamento de análises é feito pelo operador do sistema utilizando a entidade Gerenciador de
Análises. As análises são definidas em planos, os quais apresentam informações sobre o dispositivo
analisado, quais dados serão utilizados e as ferramentas empregadas na manipulação dos dados. É
permitido o gerenciamento dos planos, como a criação, edição ou remoção, pelo operador do sistema.
Como os planos são armazenadas em uma base de dados, facilmente podem ser compartilhados com outras
instâncias do Gerenciador de Análises e utilizados por outros operadores do sistema.

As informações contidas em um plano de análise ditam como determinado equipamento será analisado. Em
um primeiro momento, o operador do sistema faz a busca pelos dispositivos utilizando o Gerenciador
de Dispositivos. Com a lista de dispositivos ativos, o Gerenciador de Análises é utilizado para
definir as operações a serem realizadas em um equipamento específico. Preenchendo o plano de
análise, o operador seleciona quais dados do equipamento serão utilizados e quais as ferramentas
utilizadas para analisá-los. O plano também permite definir o intervalo de execução de cada análise
e por quanto tempo o equipamento será analisado. O diagrama \gls{UML} de casos de uso para algumas
funcionalidades do Gerenciador de Análises é apresentado na \cref{fig:uml-analysis-management}. A
estrutura do plano é armazenada na entidade Base de Dados, sendo acessível para as outras entidades
que utilizam as informações do plano.

\todo[inline]{Incluir o analisador de dispositivos na figura. Neles estão armazenadas as ferramentas
que podem ser utilizadas.}

\includefigure
  {images/uml-analysis-management}
  {Diagrama de casos de uso para o gerenciamento de análises pelo operador do sistema.}
  {fig:uml-analysis-management}

Na construção do plano de análise, os comportamentos de cada dispositivo são obtidos e incluídos na
execução. Os diferentes comportamentos podem ser mapeados para intervalos de resultados esperados
das análises. Juntamente com a \cref{fig:uml-analysis-management}, a \cref{fig:device-create-plan}
ilustra a criação de um plano de análise de dispositivo. Após obter todas as informações do
dispositivo a ser analisado, o plano é criado pelo operador do sistema. Na criação, são definidos os
intervalos de reexecução do plano, bem como a ordem das ferramentas utilizadas na manipulação dos
dados.

\includefiguretmp
  {Busca de dispositivo e criação de um plano de análise.}
  {fig:device-create-plan}

\todo[inline]{Falar da análise de um grupo de dispositivos.}

%%%
\subsection{Análise dos dados do dispositivo}

As análises dos equipamentos do sistema, anteriormente agendadas na ferramentas de Gerenciamento de
Análises, são executadas pela entidade Analisador de Dispositivos. O analisador obtém os planos e os
executa conforme programado pelo operador do sistema. Conhecendo a frequência em que cada plano deve
ser executado, uma tarefa periódica é definida. Dessa forma, chegada a hora da reexecução de um
plano, a tarefa se comunica com o Gerenciador de Análises e o dispara. Os possíveis casos de uso
para a tarefa periódica são apresentados no diagrama \gls{UML} da \cref{fig:uml-device-analysis}. A
tarefa tem a possibilidade de obter os planos de análise ativos ou selecionar diretamente um plano
conhecido. Após a carga, a tarefa pode iniciar a execução do plano. Na execução, o Analisador de
Dispositivos seleciona as ferramentas de análise, busca os dados do equipamento e, ao final,
armazena os resultados na Base de Dados.

\includefigure
  {images/uml-device-analysis}
  {Diagrama de casos de uso para a obtenção e execução das análises.}
  {fig:uml-device-analysis}

A \cref{fig:analysis-plan-execution} apresenta o fluxo de dados quando da execução de um plano de
análise pelo Analisador de Dispositivos.

\includefiguretmp
  {Diagrama de execução de uma análise de equipamento.}
  {fig:analysis-plan-execution}

O operador do sistema também pode interagir com o Analisador de Dispositivos. O diagrama de casos de
uso da \cref{fig:uml-analysis-monitoring} ilustra essa interação.

\includefiguretmp
  {Diagrama de casos de uso para o monitoramento da execução das análises.}
  {fig:uml-analysis-monitoring}


%%%
\subsection{Modos de operação do dispositivo}

Os diferentes modos de operação dos dispositivos podem ser selecionados pelo operador do sistema e
anexados ao plano de análise. O operador define, baseado nos níveis de degradação que podem ser
obtidos, qual o melhor comportamento que o equipamento deve assumir. Com o plano, o Analisador de
Dispositivos determina o índice de degradação do equipamento, verificando se está nos níveis
desejados para determinado funcionamento. Dependendo do valor obtido na análise, o analisador pode
alterar o funcionamento do equipamento, assumindo um dos comportamentos definidos anteriormente pelo
operador do sistema. A \cref{fig:uml-device-operation-modes} apresenta o diagrama \gls{UML} de casos
de uso para a seleção automática dos modos de operação do dispositivo baseado no plano de análise.

\includefiguretmp
  {Diagrama de casos de uso para seleção dos modos de operação suportados pelo dispositivo.}
  {fig:uml-device-operation-modes}


%%%
\subsection{Relatórios de saúde}

A arquitetura proposta permite a obtenção dos relatórios de saúde dos dispositivos executando sobre
equipamentos monitorados pelo sistema de manutenção inteligente. Como todos os dados das análises
são armazenados na entidade Base de Dados, é possível, a qualquer momento, resgatá-los.

\includefiguretmp
  {Diagrama de casos de uso para obtenção dos relatórios de saúde do dispositivo.}
  {fig:uml-health-device-report}
